import{B as q,H as Q,o as c,c as d,a as e,m as V,_ as X,E as P,J as Z,K as tt,t as n,b as f,d as y,F as $,C as m,f as O,A as x,L as b,i as et,M as A,e as D}from"./index-D4yXbplw.js";import{b as st,s as F}from"./index-CubMQrjb.js";import{s as at,T as ot}from"./repositorios-sGaJ6pbY.js";import{u as rt}from"./categorias-CBZr8j9o.js";import{u as it}from"./cuentas-Dy5VC7lv.js";var nt={root:{position:"relative"}},lt={root:"p-chart"},ct=q.extend({name:"chart",classes:lt,inlineStyles:nt}),dt={name:"BaseChart",extends:st,props:{type:String,data:null,options:null,plugins:null,width:{type:Number,default:300},height:{type:Number,default:150},canvasProps:{type:null,default:null}},style:ct,provide:function(){return{$pcChart:this,$parentInstance:this}}},z={name:"Chart",extends:dt,inheritAttrs:!1,emits:["select","loaded"],chart:null,watch:{data:{handler:function(){this.reinit()},deep:!0},type:function(){this.reinit()},options:function(){this.reinit()}},mounted:function(){this.initChart()},beforeUnmount:function(){this.chart&&(this.chart.destroy(),this.chart=null)},methods:{initChart:function(){var a=this;Q(()=>import("./auto-CpL4W96M.js"),[]).then(function(i){a.chart&&(a.chart.destroy(),a.chart=null),i&&i.default&&(a.chart=new i.default(a.$refs.canvas,{type:a.type,data:a.data,options:a.options,plugins:a.plugins})),a.$emit("loaded",a.chart)})},getCanvas:function(){return this.$canvas},getChart:function(){return this.chart},getBase64Image:function(){return this.chart.toBase64Image()},refresh:function(){this.chart&&this.chart.update()},reinit:function(){this.initChart()},onCanvasClick:function(a){if(this.chart){var i=this.chart.getElementsAtEventForMode(a,"nearest",{intersect:!0},!1),l=this.chart.getElementsAtEventForMode(a,"dataset",{intersect:!0},!1);i&&i[0]&&l&&this.$emit("select",{originalEvent:a,element:i[0],dataset:l})}},generateLegend:function(){if(this.chart)return this.chart.generateLegend()}}};function w(o){"@babel/helpers - typeof";return w=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},w(o)}function G(o,a){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(o);a&&(l=l.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),i.push.apply(i,l)}return i}function J(o){for(var a=1;a<arguments.length;a++){var i=arguments[a]!=null?arguments[a]:{};a%2?G(Object(i),!0).forEach(function(l){ut(o,l,i[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):G(Object(i)).forEach(function(l){Object.defineProperty(o,l,Object.getOwnPropertyDescriptor(i,l))})}return o}function ut(o,a,i){return(a=pt(a))in o?Object.defineProperty(o,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[a]=i,o}function pt(o){var a=vt(o,"string");return w(a)=="symbol"?a:a+""}function vt(o,a){if(w(o)!="object"||!o)return o;var i=o[Symbol.toPrimitive];if(i!==void 0){var l=i.call(o,a);if(w(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(o)}var gt=["width","height"];function ht(o,a,i,l,_,g){return c(),d("div",V({class:o.cx("root"),style:o.sx("root")},o.ptmi("root")),[e("canvas",V({ref:"canvas",width:o.width,height:o.height,onClick:a[0]||(a[0]=function(v){return g.onCanvasClick(v)})},J(J({},o.canvasProps),o.ptm("canvas"))),null,16,gt)],16)}z.render=ht;const mt={class:"page-header"},bt={class:"page-subtitle"},ft={class:"mes-nav"},yt={class:"mes-label"},_t={key:0,class:"loading-center"},kt={class:"kpi-grid"},Ct={class:"kpi-card card kpi-balance"},wt={class:"kpi-body"},St={class:"kpi-card card kpi-ingresos"},Pt={class:"kpi-body"},$t={class:"kpi-value text-success"},Ot={class:"kpi-card card kpi-gastos"},Dt={class:"kpi-body"},Et={class:"kpi-value text-danger"},jt={class:"kpi-card card kpi-ahorro"},Mt={class:"kpi-body"},xt={class:"charts-grid"},At={class:"card chart-card"},Ft={class:"chart-header"},zt={class:"text-muted",style:{"font-size":"0.8rem"}},Bt={key:0,class:"chart-wrap"},Nt={key:1,class:"chart-empty"},It={class:"card chart-card chart-card--wide"},Lt={key:0,class:"chart-wrap chart-wrap--tall"},Tt={class:"bottom-grid"},Rt={class:"card"},Vt={class:"chart-header"},Gt={key:0,class:"chart-empty"},Jt={key:1,class:"recientes-lista"},Wt={class:"rec-info"},Kt={class:"rec-desc"},Ut={class:"rec-fecha text-muted"},Ht={class:"card"},Yt={class:"chart-header"},qt={class:"text-muted",style:{"font-size":"0.8rem"}},Qt={key:0,class:"chart-empty"},Xt={key:1,class:"top-lista"},Zt={class:"top-rank text-muted"},te={class:"top-nombre"},ee={class:"top-bar-wrap"},se={class:"top-monto text-danger"},ae={key:0,class:"alertas-tc"},oe={class:"alerta-tc-body"},re={class:"alerta-tc-nombre"},ie={class:"alerta-tc-sub"},ne={key:0},le={key:1,style:{"margin-left":"0.75rem"}},ce={__name:"DashboardView",setup(o){et();const a=rt(),i=it(),l=P(!0),_=new Date,g=P(_.getMonth()+1),v=P(_.getFullYear()),W=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],S=b(()=>W[g.value-1]),K=b(()=>g.value===new Date().getMonth()+1&&v.value===new Date().getFullYear());function B(r){let t=g.value+r,s=v.value;t>12&&(t=1,s++),t<1&&(t=12,s--),g.value=t,v.value=s}const p=P({ingresos:0,gastos:0,balance:0,porCategoria:{},evolucion:[],recientes:[]});async function N(){l.value=!0;try{await Promise.all([a.cargar(),i.cargar()]),p.value=await ot.resumen(g.value,v.value)}catch(r){console.error("[Dashboard] Error:",r)}finally{l.value=!1}}Z(N),tt([g,v],N);const I=b(()=>p.value.ingresos?Math.round(p.value.balance/p.value.ingresos*100):0),E=b(()=>Object.fromEntries(a.categorias.map(r=>[r._id,r]))),U=r=>{var t;return((t=E.value[r])==null?void 0:t.icono)||"pi-tag"},k=r=>{var t;return((t=E.value[r])==null?void 0:t.color)||"#6366f1"},L=r=>{var t;return((t=E.value[r])==null?void 0:t.nombre)||"Sin categoría"},j=b(()=>{var s;const r=Object.entries(p.value.porCategoria).map(([u,h])=>({id:u,monto:h})).sort((u,h)=>h.monto-u.monto).slice(0,6),t=((s=r[0])==null?void 0:s.monto)||1;return r.map(u=>({...u,pct:Math.round(u.monto/t*100)}))}),M=b(()=>{const r=j.value;return r.length?{labels:r.map(t=>L(t.id)),datasets:[{data:r.map(t=>t.monto),backgroundColor:r.map(t=>k(t.id)),borderColor:"#1e293b",borderWidth:2,hoverOffset:8}]}:null}),H={responsive:!0,maintainAspectRatio:!1,cutout:"68%",plugins:{legend:{position:"right",labels:{color:"#94a3b8",font:{size:11},padding:12,boxWidth:10}},tooltip:{callbacks:{label:r=>` ${r.label}: S/ ${r.parsed.toLocaleString("es-PE",{minimumFractionDigits:2})}`}}}},T=b(()=>{const r=p.value.evolucion;if(!r.length)return null;const t=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"];return{labels:r.map(s=>{const[u,h]=s.mes.split("-");return`${t[parseInt(h)-1]} ${u}`}),datasets:[{label:"Ingresos",data:r.map(s=>s.ingresos),backgroundColor:"rgba(16,185,129,0.7)",borderColor:"#10b981",borderWidth:1,borderRadius:4},{label:"Gastos",data:r.map(s=>s.gastos),backgroundColor:"rgba(239,68,68,0.7)",borderColor:"#ef4444",borderWidth:1,borderRadius:4}]}}),Y={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{labels:{color:"#94a3b8",font:{size:11}}},tooltip:{callbacks:{label:r=>` ${r.dataset.label}: S/ ${r.parsed.y.toLocaleString("es-PE",{minimumFractionDigits:2})}`}}},scales:{x:{ticks:{color:"#94a3b8",font:{size:11}},grid:{color:"#1e293b"}},y:{ticks:{color:"#94a3b8",font:{size:11},callback:r=>`S/ ${r.toLocaleString("es-PE")}`},grid:{color:"rgba(51,65,85,0.5)"}}}},R=b(()=>{const t=new Date().getDate();return i.cuentasActivas.filter(s=>s.tipo==="credito").map(s=>{const u=s.dia_corte>=t?s.dia_corte-t:30-t+s.dia_corte,h=s.dia_pago>=t?s.dia_pago-t:30-t+s.dia_pago;return{...s,diasCorte:u,diasPago:h,urgente:u<=3||h<=3}}).filter(s=>s.diasCorte<=7||s.diasPago<=7).sort((s,u)=>s.diasCorte-u.diasCorte)}),C=r=>r!=null?`S/ ${Number(r).toLocaleString("es-PE",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"S/ 0.00";return(r,t)=>(c(),d("div",null,[e("div",mt,[e("div",null,[t[3]||(t[3]=e("h1",{class:"page-title"},"Dashboard",-1)),e("p",bt,"Resumen financiero · "+n(S.value)+" "+n(v.value),1)]),e("div",ft,[f(y(F),{icon:"pi pi-chevron-left",text:"",rounded:"",onClick:t[0]||(t[0]=s=>B(-1))}),e("span",yt,n(S.value)+" "+n(v.value),1),f(y(F),{icon:"pi pi-chevron-right",text:"",rounded:"",onClick:t[1]||(t[1]=s=>B(1)),disabled:K.value},null,8,["disabled"])])]),l.value?(c(),d("div",_t,[f(y(at),{strokeWidth:"3"})])):(c(),d($,{key:1},[e("div",kt,[e("div",Ct,[t[5]||(t[5]=e("div",{class:"kpi-icon"},[e("i",{class:"pi pi-wallet"})],-1)),e("div",wt,[t[4]||(t[4]=e("span",{class:"kpi-label"},"Balance del mes",-1)),e("span",{class:m(["kpi-value",p.value.balance>=0?"text-success":"text-danger"])},n(C(p.value.balance)),3)]),e("div",{class:m(["kpi-trend",p.value.balance>=0?"trend-up":"trend-down"])},[e("i",{class:m([p.value.balance>=0?"pi-trending-up":"pi-trending-down","pi"])},null,2)],2)]),e("div",St,[t[7]||(t[7]=e("div",{class:"kpi-icon kpi-icon--green"},[e("i",{class:"pi pi-arrow-up-right"})],-1)),e("div",Pt,[t[6]||(t[6]=e("span",{class:"kpi-label"},"Ingresos",-1)),e("span",$t,n(C(p.value.ingresos)),1)])]),e("div",Ot,[t[9]||(t[9]=e("div",{class:"kpi-icon kpi-icon--red"},[e("i",{class:"pi pi-arrow-down-right"})],-1)),e("div",Dt,[t[8]||(t[8]=e("span",{class:"kpi-label"},"Gastos",-1)),e("span",Et,n(C(p.value.gastos)),1)])]),e("div",jt,[t[11]||(t[11]=e("div",{class:"kpi-icon kpi-icon--purple"},[e("i",{class:"pi pi-percentage"})],-1)),e("div",Mt,[t[10]||(t[10]=e("span",{class:"kpi-label"},"Tasa de ahorro",-1)),e("span",{class:m(["kpi-value",I.value>=0?"text-success":"text-danger"])},n(I.value)+"% ",3)])])]),e("div",xt,[e("div",At,[e("div",Ft,[t[12]||(t[12]=e("h3",{class:"chart-title"},"Gastos por categoría",-1)),e("span",zt,n(S.value),1)]),M.value&&M.value.labels.length>0?(c(),d("div",Bt,[f(y(z),{type:"doughnut",data:M.value,options:H},null,8,["data"])])):(c(),d("div",Nt,[...t[13]||(t[13]=[e("i",{class:"pi pi-chart-pie"},null,-1),e("p",null,"Sin gastos este mes",-1)])]))]),e("div",It,[t[14]||(t[14]=e("div",{class:"chart-header"},[e("h3",{class:"chart-title"},"Ingresos vs Gastos"),e("span",{class:"text-muted",style:{"font-size":"0.8rem"}},"Últimos 6 meses")],-1)),T.value?(c(),d("div",Lt,[f(y(z),{type:"bar",data:T.value,options:Y},null,8,["data"])])):O("",!0)])]),e("div",Tt,[e("div",Rt,[e("div",Vt,[t[15]||(t[15]=e("h3",{class:"chart-title"},"Últimos movimientos",-1)),f(y(F),{label:"Ver todos",text:"",size:"small",onClick:t[2]||(t[2]=s=>r.$router.push("/transacciones"))})]),p.value.recientes.length===0?(c(),d("div",Gt,[...t[16]||(t[16]=[e("i",{class:"pi pi-inbox"},null,-1),e("p",null,"Sin transacciones registradas",-1)])])):(c(),d("div",Jt,[(c(!0),d($,null,x(p.value.recientes,s=>(c(),d("div",{key:s._id,class:"rec-item"},[e("div",{class:"rec-icon",style:A(`background:${k(s.categoria_id)}22;color:${k(s.categoria_id)}`)},[e("i",{class:m(["pi",U(s.categoria_id)])},null,2)],4),e("div",Wt,[e("span",Kt,n(s.descripcion),1),e("span",Ut,n(s.fecha),1)]),e("span",{class:m(["rec-monto",s.tipo==="ingreso"?"text-success":"text-danger"])},n(s.tipo==="ingreso"?"+":"-")+n(C(s.monto)),3)]))),128))]))]),e("div",Ht,[e("div",Yt,[t[17]||(t[17]=e("h3",{class:"chart-title"},"Top gastos",-1)),e("span",qt,n(S.value),1)]),j.value.length===0?(c(),d("div",Qt,[...t[18]||(t[18]=[e("i",{class:"pi pi-list"},null,-1),e("p",null,"Sin gastos este mes",-1)])])):(c(),d("div",Xt,[(c(!0),d($,null,x(j.value,(s,u)=>(c(),d("div",{key:s.id,class:"top-item"},[e("span",Zt,n(u+1),1),e("div",{class:"top-dot",style:A(`background:${k(s.id)}`)},null,4),e("span",te,n(L(s.id)),1),e("div",ee,[e("div",{class:"top-bar-fill",style:A(`width:${s.pct}%;background:${k(s.id)}`)},null,4)]),e("span",se,n(C(s.monto)),1)]))),128))]))])]),R.value.length>0?(c(),d("div",ae,[(c(!0),d($,null,x(R.value,s=>(c(),d("div",{key:s._id,class:m(["alerta-tc-item card",s.urgente?"alerta--danger":"alerta--warn"])},[t[21]||(t[21]=e("i",{class:"pi pi-credit-card alerta-tc-icon"},null,-1)),e("div",oe,[e("span",re,n(s.nombre),1),e("span",ie,[s.diasCorte>=0?(c(),d("span",ne,[t[19]||(t[19]=D(" Corte en ",-1)),e("strong",null,n(s.diasCorte),1),D(" días (día "+n(s.dia_corte)+") ",1)])):O("",!0),s.diasPago>=0&&s.diasPago<=7?(c(),d("span",le,[t[20]||(t[20]=D(" · Pago en ",-1)),e("strong",null,n(s.diasPago),1),D(" días (día "+n(s.dia_pago)+") ",1)])):O("",!0)])]),e("span",{class:m(["alerta-tc-badge",s.urgente?"badge--danger":"badge--warn"])},n(s.urgente?"¡Urgente!":"Próximo"),3)],2))),128))])):O("",!0)],64))]))}},he=X(ce,[["__scopeId","data-v-59dc17ab"]]);export{he as default};
